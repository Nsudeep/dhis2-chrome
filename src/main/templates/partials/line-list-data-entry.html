<div ng-controller="lineListDataEntryController">
<div class="loading" ng-show="loading">
     <img src="img/ajax-loader.gif" class="spinner" />
</div>
<section class="panel tab-panel">
	<div ng-show="resultMessageType === 'success'" class="alert alert-success">{{resultMessage}}</div>
	<div ng-show="resultMessageType === 'failure'" class="alert alert-danger">{{resultMessage}}</div>
	<form name="eventDataEntryForm" id="eventDataEntryForm" class="form-horizontal">
		<accordion close-others="false">
			<accordion-group ng-repeat="program in programs" is-open="true">
				<accordion-heading>
					<span ng-if="resourceBundle[program.id]">{{ resourceBundle[program.id] }}</span> 
					<span ng-if="!resourceBundle[program.id]">{{ program.name }}</span> 
				</accordion-heading>
                <div class="exp-coll-group" ng-repeat="programStage in program.programStages">
                    <accordion close-others="false">
                        <ul>
                            <li class="form-group">
                                <label for="eventDate" class="col-sm-4 col-md-4 control-label">{{ resourceBundle["lineListEventDate"] }}</label>
                                <div class="col-sm-6 col-md-6">
                                    <input name="eventDate" type="date" class="form-control" ng-model="getEventDateNgModel(eventDates, program.id, programStage.id)[programStage.id]" required min="{{minDateInCurrentPeriod}}" max="{{maxDateInCurrentPeriod}}" />
                                </div>
                            </li>
                        </ul>
                        <accordion-group ng-repeat="section in programStage.programStageSections" is-open="true">
                            <accordion-heading>
                                <span ng-if="resourceBundle[section.id]">{{ resourceBundle[section.id] }}</span>
                                <span ng-if="!resourceBundle[section.id]">{{ section.name }}</span>
                            </accordion-heading>
                            <ul>
                                <li class="form-group" ng-repeat="de in section.programStageDataElements">
                                    <label for="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" class="col-sm-4 col-md-4 control-label" ng-if="resourceBundle[de.dataElement.id]">{{ resourceBundle[de.dataElement.id] }}</label>
                                    <label for="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" class="col-sm-4 col-md-4 control-label" ng-if="!resourceBundle[de.dataElement.id]"> {{ de.dataElement.formName }}</label>
                                    <div class="col-sm-6 col-md-6">
                                        <input type="text" class="form-control" ng-if="de.dataElement.type === 'string' &amp;&amp; !de.dataElement.optionSet" ng-model="getDataValueNgModel(dataValues, program.id, programStage.id)[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required= "de.compulsory"/>
                                        <input type="number" class="form-control" ng-if="de.dataElement.type === 'int' &amp;&amp; !de.dataElement.optionSet" ng-model="getDataValueNgModel(dataValues, program.id, programStage.id)[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required= "de.compulsory"/>
                                        <input type="date" class="form-control" ng-if="de.dataElement.type === 'date' &amp;&amp; !de.dataElement.optionSet" ng-model="getDataValueNgModel(dataValues, program.id, programStage.id)[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required= "de.compulsory"/>
                                        <select ng-options="o.name as o.displayName for o in getOptionsFor(de.dataElement.optionSet.id)" ng-if="de.dataElement.optionSet" ng-model="getDataValueNgModel(dataValues, program.id, programStage.id)[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required= "de.compulsory">
                                            <option value=""></option>
                                        </select>
                                        <div ng-show="eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$dirty &amp;&amp; eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$invalid">
			                                <span class="errortxt" ng-show="eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$error.required"> {{de.dataElement.formName}} {{resourceBundle.required}}</span>
			                            </div>
                                    </div>
                                </li>
                            </ul>
                        </accordion-group>
                    </accordion>
                    <ul>
                        <li>
                            <div class="col-sm-offset-4 col-sm-6 col-md-offset-4 col-md-6">
                                <input type="button" class="btn btn-main" value="Save" ng-click="submit(true)" ng-disabled="eventDataEntryForm.$invalid"/>
                                <input type="button" class="btn btn-main" value="Submit" ng-click="submit(false)"  ng-disabled="eventDataEntryForm.$invalid"/>
                            </div>
                        </li>
                    </ul>
                </div>
				<div ng-if="allEvents.length &gt; 0">
					<div ng-show="deleteSuccess" class="alert alert-success">{{resourceBundle.eventDeleteSuccess}}</div>
					<div class="panel panel-heading">
						<h3 class="panel-title">{{resourceBundle.eventListTitle}}</h3>
					</div>
					<accordion close-others="false">
						<table class="table table-bordered">
							<thead>
								<tr>
									<th>Event Date</th>
									<th ng-repeat= "dataValue in allEvents[0].dataValues" ng-if = "dataValue.showInEventSummary">
										{{dataValue.formName}}
									</th>
									<th></th>
									<th></th>
									<th></th>
								</tr>
							</thead>
							<tbody>
								<tr  ng-repeat="event in allEvents">
									<td>{{event.eventDate | date:'yyyy-MM-dd'}}</td>
									<td ng-repeat= "dataValue in event.dataValues" ng-if="dataValue.showInEventSummary">
										<span ng-if="dataValue.type === 'date'">{{dataValue.value | date:'yyyy-MM-dd'}}</span>
										<span ng-if="dataValue.type !== 'date'">{{dataValue.value}}</span>
									</td>
									<td>
					                    <a href="" id="" title="View" class="view">
					                        <span class="glyphicon glyphicon-info-sign"></span>
					                    </a>
					                </td>
									<td>
					                    <a href="" id="" title="Edit" class="edit">
					                        <span class="glyphicon glyphicon-edit"></span>
					                    </a>
					                </td>
					                <td>
					                    <a href="" id="" ng-click="deleteEvent(event)" title="Delete" class="delete">
                                            <span class="glyphicon glyphicon-remove"></span>
                                        </a>
					                </td>
								</tr>
							</tbody>
						</table>
					</accordion>
				</div>
			</accordion-group>
		</accordion>
	</form>		
</section>
</div>