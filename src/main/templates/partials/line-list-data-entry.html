<div ng-controller="lineListDataEntryController">
    <div class="loading" ng-show="loading">
        <img src="img/ajax-loader.gif" class="spinner" />
    </div>
    <section class="panel tab-panel">
        <div>
            <div ng-show="resultMessageType === 'success'" class="alert alert-success">{{ resultMessage }}</div>
            <div ng-show="resultMessageType === 'failure'" class="alert alert-danger">{{ resultMessage }}</div>
            <form name="form.eventDataEntryForm" id="form.eventDataEntryForm" class="form-horizontal">
                <accordion close-others="false">
                    <accordion-group is-open="true">
                        <accordion-heading>
                            <span ng-if="resourceBundle[program.id]">{{ resourceBundle[program.id] }}</span>
                            <span ng-if="!resourceBundle[program.id]">{{ program.name }}</span>
                        </accordion-heading>
                        <div class="exp-coll-group" ng-repeat="programStage in program.programStages">
                            <accordion close-others="false">
                                <ul>
                                    <li class="form-group">
                                        <label for="eventDate" class="col-sm-4 col-md-4 control-label">{{ resourceBundle.lineListEventDate }}</label>
                                        <div class="col-sm-6 col-md-6">
                                            <input name="eventDate" type="date" class="form-control" ng-model="getEventDateNgModel(eventDates, program.id, programStage.id)[programStage.id]" required min="{{ minDateInCurrentPeriod }}" max="{{ maxDateInCurrentPeriod }}" />
                                        </div>
                                    </li>
                                    <li class="form-group">
                                        <label for="patientOrigin" class="col-sm-4 col-md-4 control-label">{{ resourceBundle.patientOriginLabel }}</label>
                                        <div class="col-sm-6 col-md-6">
                                            <select ng-options="o.name for o in originOrgUnits" ng-model="patientOrigin.selected" name="patientOrigin" required>
                                                <option value=""></option>
                                            </select>
                                        </div>
                                    </li>
                                </ul>
                                <accordion-group ng-repeat="section in programStage.programStageSections | orderBy: 'sortOrder'" is-open="true">
                                    <accordion-heading>
                                        <span ng-if="resourceBundle[section.id]">{{ resourceBundle[section.id] }}</span>
                                        <span ng-if="!resourceBundle[section.id]">{{ section.name }}</span>
                                    </accordion-heading>
                                    <ul>
                                        <div ng-repeat="de in section.programStageDataElements">
                                            <li class="form-group" ng-if="de.dataElement.isIncluded">
                                                <div ng-if="de.dataElement.isIncluded">
                                                    <label for="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" class="col-sm-4 col-md-4 control-label" ng-if="resourceBundle[de.dataElement.id]">{{ resourceBundle[de.dataElement.id] }}</label>
                                                    <label for="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" class="col-sm-4 col-md-4 control-label" ng-if="!resourceBundle[de.dataElement.id]"> {{ de.dataElement.formName }}</label>
                                                </div>
                                                <div class="col-sm-6 col-md-6" ng-if="de.dataElement.isIncluded">
                                                    <input type="text" class="form-control" ng-if="de.dataElement.type === 'string' &amp;&amp; !de.dataElement.optionSet" ng-model="dataValues[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required="de.compulsory" />
                                                    <input type="number" class="form-control" ng-if="de.dataElement.type === 'int' &amp;&amp; !de.dataElement.optionSet" ng-model="dataValues[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required="de.compulsory" ng-pattern="numberPattern" />
                                                    <input type="date" class="form-control" ng-if="de.dataElement.type === 'date' &amp;&amp; !de.dataElement.optionSet" ng-model="dataValues[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required="de.compulsory" />
                                                    <div ng-if="de.dataElement.type === 'bool' &amp;&amp; !de.dataElement.optionSet" class="col-sm-8 col-md-8 form-inline">
                                                        <div class="radio-inline">
                                                            <label for="Yes">
                                                                <input type="radio" ng-model="dataValues[de.dataElement.id]" value="true" ng-required="de.compulsory"> {{resourceBundle.yes}}
                                                            </label>
                                                        </div>
                                                        <div class="radio-inline">
                                                            <label for="No">
                                                                <input type="radio" ng-model="dataValues[de.dataElement.id]" value="false" ng-required="de.compulsory"> {{resourceBundle.no}}
                                                            </label>
                                                        </div>
                                                    </div>
                                                    <select ng-options="o.code as o.displayName for o in getOptionsFor(de.dataElement.optionSet.id)" ng-if="de.dataElement.optionSet" ng-model="dataValues[de.dataElement.id]" name="eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}" ng-required="de.compulsory">
                                                        <option value=""></option>
                                                    </select>
                                                    <div ng-show="form.eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$dirty &amp;&amp; form.eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$invalid">
                                                        <span class="errortxt" ng-show="form.eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$error.required"> {{de.dataElement.formName}} {{resourceBundle.required}}</span>
                                                        <span class="errortxt" ng-show="form.eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$error.date"> {{resourceBundle.dateInvalid}}</span>
                                                        <span class="errortxt" ng-show="form.eventDataEntryForm.eventValue_{{program.id}}_{{programStage.id}}_{{de.dataElement.id}}.$error.pattern"> {{de.dataElement.formName}} {{resourceBundle.invalidPattern}}</span>
                                                    </div>
                                                </div>
                                            </li>
                                        </div>
                                    </ul>
                                </accordion-group>
                            </accordion>
                            <ul>
                                <li>
                                    <div class="text-center">
                                        <input type="button" class="btn btn-main" value="Save Case" ng-click="save(programStage)" ng-disabled="form.eventDataEntryForm.$invalid" ng-if="isNewMode" />
                                        <input type="button" class="btn btn-main" value="Save and Add Another" ng-click="save(programStage, true)" ng-disabled="form.eventDataEntryForm.$invalid" ng-if="isNewMode" />
                                        <input type="button" class="btn btn-main" value="Update" ng-click="update(programStage)" ng-disabled="form.eventDataEntryForm.$invalid" ng-if="!isNewMode" />
                                        <input type="button" class="btn btn-main" value="Cancel" ng-click="loadEventsView()" />
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </accordion-group>
                </accordion>
            </form>
        </div>
    </section>
</div>
