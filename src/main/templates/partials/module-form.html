<div class="panel panel-default" ng-controller="moduleController">
	<div ng-show="saveFailure" class="alert alert-danger">{{ resourceBundle.errorModule }}</div>
	<div class="panel-heading">
		<h3 class="panel-title">Module Details</h3>
		<div class="actions">
			<button class="btn btn-add btn-xs" ng-click="addModules()" ng-if="isEditMode">Add Module</button>
		</div>
	</div>
	<div class="panel-body">
		<form class="form-horizontal" name="form" role="form" ng-submit="save(modules)" novalidate>
			<div class="well" ng-repeat="module in modules">
				<button class="btn-delete" ng-hide="$first || !isEditMode" ng-click="delete($index)">X Delete</button>
				<ul>
					<li class="form-group">
						<label for="moduleName" class="col-sm-4 col-md-4 control-label">Module name</label>
						<div class="col-sm-4">
							<input type="text" class="form-control" name="moduleName" id="moduleName" placeholder="Module Name" ng-model="module.name" not-in="allModules" ng-disabled="!isEditMode" required>
							<div ng-show="form.moduleName.$dirty &amp;&amp; form.moduleName.$invalid">
								<span class="errortxt" ng-show="form.moduleName.$error.required">{{resourceBundle.nameValidation}}</span>
								<span class="errortxt" ng-show="form.moduleName.$error.isWithin">{{resourceBundle.alreadyExists}}</span>
							</div>
						</div>
					</li>
					<li class="form-group">
						<label for="moduleName" class="col-sm-4 col-md-4 control-label" ng-show="isEditMode">Add service</label>
						<label for="moduleName" class="col-sm-4 col-md-4 control-label" ng-hide="isEditMode">Services</label>
					</li>
					<li class="form-group">
						<div class="col-sm-12" ng-show="isEditMode">
							<section class="module-details">
								<div class="add-item-ctrl">
									<div ng-show="areDatasetsNotSelected([module])">
										<span>{{resourceBundle.selectDatasets}}</span>
									</div>
									<multiselect left-list="module.allDatasets" name="name" ng-model="module.datasets" disabled="!isEditMode" on-right-item-select="selectDataSet(module, item)" on-move-left="discardDataSet(module, items)" select-first-item="true"></multiselect>
								</div>
								<div class="details" ng-show="module.selectedDataset.sections.length > 0">
								<span ng-show="areNoSectionsSelectedForDataset(module, module.selectedDataset)">{{resourceBundle.selectDatasetSection}}</span> 
								<h4 ng-class="{cur: true}">{{module.selectedDataset.name}}</h4>
								<div ng-repeat="section in module.selectedDataset.sections">
									<div class="collapse-head">
										<h5 ng-click="isExpanded[section.id] = !isExpanded[section.id]">{{section.name}}</h5>
										<input type="checkbox" ng-change="changeSectionSelection(module, section)" ng-model="module.selectedSections[section.id]">
									</div>
									<div collapse="!isExpanded[section.id]" class="collapse-body">
										<ul>
											<li ng-repeat="element in section.dataElements">
												<label>
													<input type="checkbox" ng-model="module.selectedDataElements[element.id]" ng-change="changeDataElementSelection(module, section)"> {{element.formName}}
												</label>
											</li>
										</ul>
									</div>
								</div>
								</div>
							</section>
						</div>
						<div ng-show="!isEditMode">
							<section class="view-module-details">
							<div name="left-side" class="content left">
								<ul>
									<li ng-repeat="dataset in module.datasets">
										<h5 ng-click="selectDataSet(module, dataset)" ng-class="{sel: dataset === module.selectedDataset}">{{dataset.name}}</h5>
									</li>
								</ul>
							</div>
							<div name="right-side" class="content right">
								<div ng-repeat="section in module.selectedDataset.sections">
									<div class="collapse-head" style="position:relative">
										<h5 ng-click="isExpanded[section.id] = !isExpanded[section.id]" style="background:#ccc;display:block;padding:10px;cursor:pointer;">{{section.name}} </h5>
									</div>
									<div collapse="!isExpanded[section.id]">
										<ul>
											<li ng-repeat="element in section.dataElements">
												<label>
													{{element.formName}}
												</label>
											</li>
										</ul>
									</div>
								</div>
							</div>
						</section>
						</div>
					</li>
				</ul>
			</div>
			<button class="btn btn-main pull-right" ng-disabled="form.$invalid || areDatasetsNotSelected(modules) || areNoSectionsSelected(modules)" ng-if="isEditMode">Save</button>
		</form>
		
	</div>
</div>